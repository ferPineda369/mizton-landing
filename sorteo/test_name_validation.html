<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Validación de Nombres</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-user-check"></i> Test Validación de Nombres con Acentos y Diéresis</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h6>Prueba diferentes nombres:</h6>
                            <div class="mb-3">
                                <label class="form-label">Nombre a probar:</label>
                                <input type="text" class="form-control" id="testName" placeholder="Ingresa un nombre para probar">
                            </div>
                            <button class="btn btn-primary" onclick="testNameValidation()">
                                <i class="fas fa-check"></i> Validar Nombre
                            </button>
                        </div>
                        
                        <hr>
                        
                        <div class="mb-4">
                            <h6>Casos de prueba predefinidos:</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-success" onclick="testPredefinedName('José María')">
                                            José María
                                        </button>
                                        <button class="btn btn-outline-success" onclick="testPredefinedName('Ángela Rodríguez')">
                                            Ángela Rodríguez
                                        </button>
                                        <button class="btn btn-outline-success" onclick="testPredefinedName('Raúl Müller')">
                                            Raúl Müller
                                        </button>
                                        <button class="btn btn-outline-success" onclick="testPredefinedName('Güero Pérez')">
                                            Güero Pérez
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-success" onclick="testPredefinedName('Niño Hernández')">
                                            Niño Hernández
                                        </button>
                                        <button class="btn btn-outline-success" onclick="testPredefinedName('Sofía Íñiguez')">
                                            Sofía Íñiguez
                                        </button>
                                        <button class="btn btn-outline-success" onclick="testPredefinedName('Müller González')">
                                            Müller González
                                        </button>
                                        <button class="btn btn-outline-success" onclick="testPredefinedName('Yücel Martínez')">
                                            Yücel Martínez
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="mb-4">
                            <h6>Casos que NO deben pasar:</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-danger" onclick="testPredefinedName('Juan123')">
                                            Juan123 (números)
                                        </button>
                                        <button class="btn btn-outline-danger" onclick="testPredefinedName('María@gmail')">
                                            María@gmail (símbolos)
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-danger" onclick="testPredefinedName('Jo')">
                                            Jo (muy corto)
                                        </button>
                                        <button class="btn btn-outline-danger" onclick="testPredefinedName('')">
                                            (vacío)
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="testResults" class="mt-3"></div>
                        
                        <div class="alert alert-info mt-4">
                            <h6><i class="fas fa-info-circle"></i> Caracteres soportados:</h6>
                            <ul class="mb-0">
                                <li><strong>Letras básicas:</strong> a-z, A-Z</li>
                                <li><strong>Acentos:</strong> á, é, í, ó, ú, Á, É, Í, Ó, Ú</li>
                                <li><strong>Diéresis:</strong> ü, Ü</li>
                                <li><strong>Eñe:</strong> ñ, Ñ</li>
                                <li><strong>Espacios:</strong> Permitidos entre palabras</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Función de validación (copiada del sorteo real)
        function validateName(name) {
            return name.trim().length >= 3 && /^[a-zA-ZáéíóúüÁÉÍÓÚÜñÑ\s]+$/.test(name.trim());
        }
        
        function testNameValidation() {
            const name = document.getElementById('testName').value;
            testPredefinedName(name);
        }
        
        function testPredefinedName(name) {
            document.getElementById('testName').value = name;
            
            const isValid = validateName(name);
            const trimmedName = name.trim();
            
            let resultClass = isValid ? 'success' : 'danger';
            let resultIcon = isValid ? 'check-circle' : 'times-circle';
            let resultText = isValid ? 'VÁLIDO' : 'INVÁLIDO';
            
            let details = [];
            
            if (trimmedName.length < 3) {
                details.push('❌ Muy corto (mínimo 3 caracteres)');
            } else {
                details.push('✅ Longitud suficiente');
            }
            
            if (/^[a-zA-ZáéíóúüÁÉÍÓÚÜñÑ\s]+$/.test(trimmedName)) {
                details.push('✅ Solo contiene caracteres válidos');
            } else {
                details.push('❌ Contiene caracteres no válidos');
            }
            
            if (/[0-9]/.test(trimmedName)) {
                details.push('❌ Contiene números');
            }
            
            if (/[^a-zA-ZáéíóúüÁÉÍÓÚÜñÑ\s]/.test(trimmedName)) {
                details.push('❌ Contiene símbolos especiales');
            }
            
            const detailsHtml = details.map(d => `<li>${d}</li>`).join('');
            
            showResult(`
                <div class="alert alert-${resultClass}">
                    <h6><i class="fas fa-${resultIcon}"></i> Resultado: ${resultText}</h6>
                    <p><strong>Nombre probado:</strong> "${name}"</p>
                    <ul>${detailsHtml}</ul>
                </div>
            `);
            
            // Simular llamada a API
            if (isValid) {
                simulateAPICall(name);
            }
        }
        
        async function simulateAPICall(name) {
            try {
                // Simular datos de prueba
                const formData = new FormData();
                formData.append('number', '17');
                formData.append('fullName', name);
                formData.append('phoneNumber', '2226536090');
                
                const response = await fetch('api/register_number.php', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showResult(`
                        <div class="alert alert-success">
                            <h6><i class="fas fa-check-circle"></i> ✅ API Test EXITOSO</h6>
                            <p><strong>Nombre:</strong> "${name}" fue aceptado por el servidor</p>
                            <p><strong>Mensaje:</strong> ${data.message}</p>
                        </div>
                    `, true);
                } else {
                    showResult(`
                        <div class="alert alert-danger">
                            <h6><i class="fas fa-times-circle"></i> ❌ API Test FALLÓ</h6>
                            <p><strong>Nombre:</strong> "${name}" fue rechazado por el servidor</p>
                            <p><strong>Error:</strong> ${data.message}</p>
                        </div>
                    `, true);
                }
            } catch (error) {
                showResult(`
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle"></i> ⚠️ Error de Conexión</h6>
                        <p>No se pudo conectar con la API para probar "${name}"</p>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `, true);
            }
        }
        
        function showResult(html, append = false) {
            const resultsDiv = document.getElementById('testResults');
            if (append) {
                resultsDiv.innerHTML += html;
            } else {
                resultsDiv.innerHTML = html;
            }
            
            // Scroll al resultado
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // Test automático al cargar
        window.onload = function() {
            showResult(`
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle"></i> Listo para probar</h6>
                    <p>Selecciona un nombre de los botones o escribe uno personalizado</p>
                </div>
            `);
        };
    </script>
</body>
</html>
