RewriteEngine On

# PRIMERA REGLA: Redirigir /news/admin a archivo especial
RewriteRule ^news/admin(/.*)?$ news/admin.php [L,QSA]

# Reglas para URLs de news (DESPUÉS DE LA REDIRECCIÓN ADMIN)
# 1. Códigos de referido en news index: /news/referido (6 caracteres exactos)
RewriteRule ^news/([a-zA-Z0-9]{6})/?$ news/index.php?ref=$1 [L,QSA]

# 2. Posts con referido: /news/slug-del-post/codigo-referido
RewriteRule ^news/([a-zA-Z0-9-]+)/([a-zA-Z0-9]{6})/?$ news/post.php?slug=$1&ref=$2 [L,QSA]

# 3. Posts sin referido: /news/slug-del-post (debe ir al final)
RewriteRule ^news/([a-zA-Z0-9-]+)/?$ news/post.php?slug=$1 [L,QSA]

# Reglas para códigos de referido en landing (DESPUÉS DE NEWS)
# Excluir directorios y archivos existentes
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# Excluir rutas específicas conocidas
RewriteCond %{REQUEST_URI} !^/(news|blog|api|assets|config|includes|docs|admin)(/.*)?$

# Excluir archivos con extensiones comunes
RewriteCond %{REQUEST_URI} !^/.*\.(php|html|css|js|jpg|jpeg|png|gif|svg|ico|pdf|zip|txt|xml|json)$

# Capturar códigos de referido de exactamente 6 caracteres alfanuméricos (landing)
RewriteRule ^([a-zA-Z0-9]{6})/?$ index.php?ref=$1 [L,QSA]

# Redireccionar URLs con parámetro ref a formato limpio (opcional, para SEO)
RewriteCond %{QUERY_STRING} ^ref=([a-zA-Z0-9]{6})$
RewriteRule ^index\.php$ /%1? [R=301,L]

# Redireccionar URLs con parámetro ref a formato limpio desde raíz
RewriteCond %{QUERY_STRING} ^ref=([a-zA-Z0-9]{6})$
RewriteRule ^$ /%1? [R=301,L]
