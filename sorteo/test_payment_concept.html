<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Concepto de Pago</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-credit-card"></i> Test Concepto de Pago</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Simular Sesi√≥n</h6>
                                <div class="mb-3">
                                    <label class="form-label">N√∫mero Celular:</label>
                                    <input type="text" class="form-control" id="testPhone" value="2226536090">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Nombre Completo:</label>
                                    <input type="text" class="form-control" id="testName" value="Juan P√©rez">
                                </div>
                                <button class="btn btn-primary" onclick="saveTestSession()">
                                    <i class="fas fa-save"></i> Guardar Sesi√≥n
                                </button>
                                <button class="btn btn-secondary ms-2" onclick="clearTestSession()">
                                    <i class="fas fa-trash"></i> Limpiar
                                </button>
                            </div>
                            
                            <div class="col-md-6">
                                <h6>Pruebas</h6>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" onclick="testConceptUpdate()">
                                        <i class="fas fa-sync"></i> Test Actualizaci√≥n Concepto
                                    </button>
                                    <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#paymentDataModal">
                                        <i class="fas fa-credit-card"></i> Abrir Modal Datos Pago
                                    </button>
                                    <button class="btn btn-info" onclick="simulateReservedTickets()">
                                        <i class="fas fa-ticket-alt"></i> Simular Boletos Reservados
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <!-- Simulaci√≥n de consulta de boletos -->
                        <div id="consultaResultados" style="display: none;">
                            <h6>Resultados de Consulta:</h6>
                            <div id="boletosEncontrados"></div>
                        </div>
                        
                        <div id="testResults" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Datos de Pago (simulado) -->
    <div class="modal fade" id="paymentDataModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-university"></i> Datos para Dep√≥sito Bancario
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-success mb-3">
                                <div class="card-header bg-success text-white">
                                    <i class="fas fa-university"></i> Informaci√≥n Bancaria
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">CLABE:</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" value="012180015545193401" readonly>
                                            <button class="btn btn-outline-success" type="button">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Banco:</label>
                                        <input type="text" class="form-control" value="BBVA" readonly>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Titular:</label>
                                        <input type="text" class="form-control" value="Ileana Pineda Calder√≥n" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card border-warning mb-3">
                                <div class="card-header bg-warning text-dark">
                                    <i class="fas fa-dollar-sign"></i> Informaci√≥n de Pago
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Monto por boleto:</label>
                                        <div class="h4 text-success">$25.00 MXN</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Concepto requerido:</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" value="Apoyo a Pahuata" readonly id="conceptoInput">
                                            <button class="btn btn-outline-warning" type="button">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                        <div class="form-text">Incluye tu n√∫mero celular al concepto</div>
                                    </div>
                                    
                                    <div class="alert alert-warning">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <strong>Recuerda:</strong> Tienes 30 minutos para realizar el pago despu√©s de reservar tus n√∫meros.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Funciones de sesi√≥n
        function saveUserSession(phoneNumber, fullName, selectedNumbers = [], reservationExpires = null) {
            const sessionData = {
                phoneNumber: phoneNumber,
                fullName: fullName,
                selectedNumbers: selectedNumbers,
                timestamp: Date.now(),
                reservationExpires: reservationExpires
            };
            localStorage.setItem('sorteo_user_session', JSON.stringify(sessionData));
            return sessionData;
        }
        
        function getUserSession() {
            try {
                const sessionData = localStorage.getItem('sorteo_user_session');
                if (sessionData) {
                    const parsed = JSON.parse(sessionData);
                    const maxAge = 24 * 60 * 60 * 1000;
                    if (Date.now() - parsed.timestamp < maxAge) {
                        return parsed;
                    }
                }
            } catch (error) {
                console.error('Error recuperando sesi√≥n:', error);
            }
            return null;
        }
        
        function clearUserSession() {
            localStorage.removeItem('sorteo_user_session');
        }
        
        // Funci√≥n para actualizar concepto de pago
        function updatePaymentConcept(phoneNumber) {
            const conceptoInput = document.getElementById('conceptoInput');
            if (conceptoInput && phoneNumber && /^[0-9]{10}$/.test(phoneNumber)) {
                conceptoInput.value = `Apoyo a Pahuata ${phoneNumber}`;
                showResult(`‚úÖ Concepto actualizado: "Apoyo a Pahuata ${phoneNumber}"`, 'success');
            } else if (conceptoInput) {
                conceptoInput.value = 'Apoyo a Pahuata';
                showResult(`‚ö†Ô∏è Concepto sin n√∫mero: "Apoyo a Pahuata"`, 'warning');
            }
        }
        
        // Funciones de prueba
        function saveTestSession() {
            const phone = document.getElementById('testPhone').value;
            const name = document.getElementById('testName').value;
            
            if (!phone || !name) {
                showResult('Por favor completa ambos campos', 'warning');
                return;
            }
            
            const session = saveUserSession(phone, name, [17, 22, 45]);
            showResult(`Sesi√≥n guardada: ${session.phoneNumber} - ${session.fullName}`, 'success');
            
            // Actualizar concepto autom√°ticamente
            updatePaymentConcept(phone);
        }
        
        function clearTestSession() {
            clearUserSession();
            document.getElementById('testPhone').value = '';
            document.getElementById('testName').value = '';
            document.getElementById('conceptoInput').value = 'Apoyo a Pahuata';
            showResult('Sesi√≥n limpiada', 'info');
        }
        
        function testConceptUpdate() {
            const session = getUserSession();
            if (session && session.phoneNumber) {
                updatePaymentConcept(session.phoneNumber);
            } else {
                showResult('No hay sesi√≥n guardada para probar', 'warning');
            }
        }
        
        function simulateReservedTickets() {
            const session = getUserSession();
            if (!session) {
                showResult('Primero guarda una sesi√≥n para simular boletos reservados', 'warning');
                return;
            }
            
            const consultaDiv = document.getElementById('consultaResultados');
            const boletosDiv = document.getElementById('boletosEncontrados');
            
            // Simular HTML de boletos reservados
            boletosDiv.innerHTML = `
                <div class="alert alert-success">
                    <h6><i class="fas fa-check-circle"></i> ¬°Encontrados! Se encontraron 2 boleto(s) para el n√∫mero ${session.phoneNumber}</h6>
                </div>
                
                <div class="card mb-2">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <h5 class="mb-0">
                                    <span class="badge bg-primary fs-6">N¬∫ 17</span>
                                </h5>
                            </div>
                            <div class="col-md-3">
                                <strong>${session.fullName}</strong>
                            </div>
                            <div class="col-md-3">
                                <span class="badge bg-warning">
                                    <i class="fas fa-clock"></i> Reservado
                                </span>
                            </div>
                            <div class="col-md-4">
                                <small class="text-muted">
                                    Reservado: 16/11/2025 22:30<br>
                                    Expira: 25:45
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning mt-3">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h6><i class="fas fa-clock"></i> ¬°Te falta muy poco para conseguir tus boletos!</h6>
                            <p class="mb-0">Realiza tu pago y env√≠alo al administrador del grupo de WhatsApp para que te sea aprobado.</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#paymentDataModal">
                                <i class="fas fa-credit-card"></i> Datos para Pagar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            consultaDiv.style.display = 'block';
            showResult('Simulaci√≥n de boletos reservados creada. Haz clic en "Datos para Pagar"', 'info');
        }
        
        function showResult(message, type) {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
        }
        
        // Event listener para cuando se abra el modal
        document.addEventListener('DOMContentLoaded', function() {
            const paymentModal = document.getElementById('paymentDataModal');
            if (paymentModal) {
                paymentModal.addEventListener('show.bs.modal', function() {
                    console.log('Modal de datos de pago abierto');
                    
                    // Obtener n√∫mero de la sesi√≥n
                    const session = getUserSession();
                    if (session && session.phoneNumber) {
                        updatePaymentConcept(session.phoneNumber);
                        showResult(`üîÑ Modal abierto - Concepto actualizado autom√°ticamente con: ${session.phoneNumber}`, 'info');
                    } else {
                        showResult('‚ö†Ô∏è Modal abierto - No hay sesi√≥n para actualizar concepto', 'warning');
                    }
                });
            }
            
            // Cargar sesi√≥n al iniciar si existe
            const session = getUserSession();
            if (session) {
                document.getElementById('testPhone').value = session.phoneNumber;
                document.getElementById('testName').value = session.fullName;
                updatePaymentConcept(session.phoneNumber);
                showResult(`üì± Sesi√≥n cargada autom√°ticamente: ${session.phoneNumber}`, 'info');
            }
        });
    </script>
</body>
</html>
