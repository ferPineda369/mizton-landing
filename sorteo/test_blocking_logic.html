<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Lógica de Bloqueo</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .number-card { 
            display: inline-block; 
            width: 50px; 
            height: 50px; 
            margin: 5px; 
            text-align: center; 
            line-height: 50px; 
            border: 2px solid #ccc; 
            border-radius: 5px; 
            cursor: pointer;
        }
        .available { background-color: #28a745; color: white; }
        .blocked { background-color: #FF8C00; color: white; cursor: not-allowed; }
        .selected { background-color: #FFD700; color: black; }
    </style>
</head>
<body>
    <h1>Test - Lógica de Bloqueo del Sorteo</h1>
    
    <div class="test-case info">
        <h3>Escenario de Prueba:</h3>
        <p><strong>Usuario A</strong> selecciona el número 14 → debe bloquearse para otros usuarios</p>
        <p><strong>Usuario B</strong> intenta seleccionar el número 14 → debe estar deshabilitado</p>
    </div>
    
    <div class="test-case">
        <h3>Simulación Visual:</h3>
        <p><strong>Vista del Usuario A:</strong></p>
        <div class="number-card available" onclick="selectNumber(this, 14, 'A')">14</div>
        <span id="status-a">Disponible para selección</span>
        
        <p><strong>Vista del Usuario B (después de que A seleccione):</strong></p>
        <div class="number-card blocked" id="number-b">14</div>
        <span id="status-b">Bloqueado por otro usuario</span>
    </div>
    
    <div class="test-case">
        <h3>Verificaciones Implementadas:</h3>
        <ul>
            <li>✅ <strong>renderNumbers():</strong> Solo agrega event listener si <code>canClick = true</code></li>
            <li>✅ <strong>canClick:</strong> <code>(available && !blockedByOther) || alreadySelected</code></li>
            <li>✅ <strong>toggleNumber():</strong> Doble verificación de estado y bloqueo</li>
            <li>✅ <strong>CSS:</strong> <code>cursor: not-allowed</code> para números bloqueados</li>
            <li>✅ <strong>Auto-refresh:</strong> Actualización cada 5 segundos</li>
        </ul>
    </div>
    
    <div class="test-case success">
        <h3>Comportamiento Esperado:</h3>
        <ol>
            <li><strong>Usuario A selecciona 14:</strong> Se marca como seleccionado (dorado)</li>
            <li><strong>Servidor recibe bloqueo:</strong> Número 14 bloqueado por sesión de A</li>
            <li><strong>Usuario B ve actualización:</strong> Número 14 aparece naranja (bloqueado)</li>
            <li><strong>Usuario B intenta click:</strong> No hay event listener, cursor = not-allowed</li>
            <li><strong>Si B logra hacer click:</strong> toggleNumber() rechaza con alert</li>
        </ol>
    </div>
    
    <div class="test-case">
        <h3>Flujo de Datos:</h3>
        <pre>
1. Usuario A: click → toggleNumber() → updateBlocksOnServer()
2. Servidor: INSERT en sorteo_temp_blocks (session_id_A, number=14)
3. Usuario B: loadNumbers() cada 5s → API devuelve is_blocked_by_other=true
4. Usuario B: renderNumbers() → canClick=false → sin event listener
5. Usuario B: ve número naranja, cursor not-allowed
        </pre>
    </div>
    
    <script>
        function selectNumber(element, number, user) {
            if (user === 'A') {
                element.className = 'number-card selected';
                element.onclick = null;
                document.getElementById('status-a').textContent = 'Seleccionado - Bloqueado para otros';
                
                // Simular bloqueo para usuario B
                document.getElementById('number-b').className = 'number-card blocked';
                document.getElementById('number-b').onclick = function() {
                    alert('Ese número está siendo reservado por otro usuario. Puedes esperar 2 minutos para confirmar si fue comprado o elegir otro número disponible.');
                };
                document.getElementById('status-b').textContent = 'BLOQUEADO - No clickeable';
            }
        }
    </script>
</body>
</html>
