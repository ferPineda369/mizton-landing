<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Sistema de Sesi√≥n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-user-check"></i> Test Sistema de Sesi√≥n</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Guardar Sesi√≥n</h6>
                                <div class="mb-3">
                                    <label class="form-label">N√∫mero Celular:</label>
                                    <input type="text" class="form-control" id="testPhone" placeholder="2226536090">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Nombre Completo:</label>
                                    <input type="text" class="form-control" id="testName" placeholder="Juan P√©rez">
                                </div>
                                <button class="btn btn-primary" onclick="saveTestSession()">
                                    <i class="fas fa-save"></i> Guardar Sesi√≥n
                                </button>
                            </div>
                            
                            <div class="col-md-6">
                                <h6>Acciones de Sesi√≥n</h6>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-success" onclick="loadTestSession()">
                                        <i class="fas fa-download"></i> Cargar Sesi√≥n
                                    </button>
                                    <button class="btn btn-warning" onclick="showSessionInfo()">
                                        <i class="fas fa-info"></i> Ver Informaci√≥n
                                    </button>
                                    <button class="btn btn-danger" onclick="clearTestSession()">
                                        <i class="fas fa-trash"></i> Limpiar Sesi√≥n
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div id="sessionResults" class="mt-3"></div>
                        
                        <div class="alert alert-info mt-4">
                            <h6><i class="fas fa-info-circle"></i> Funcionalidades Implementadas:</h6>
                            <ul class="mb-0">
                                <li><strong>Auto-completar:</strong> Los campos se llenan autom√°ticamente al abrir el modal</li>
                                <li><strong>Auto-consulta:</strong> Se consultan autom√°ticamente los boletos al cargar la p√°gina</li>
                                <li><strong>Persistencia:</strong> Los datos se mantienen por 24 horas</li>
                                <li><strong>Consulta inteligente:</strong> Si no ingresas n√∫mero, usa el guardado</li>
                                <li><strong>Leyenda especial:</strong> Mensaje para boletos reservados</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Simular las funciones de sesi√≥n
        function saveUserSession(phoneNumber, fullName, selectedNumbers = []) {
            const sessionData = {
                phoneNumber: phoneNumber,
                fullName: fullName,
                selectedNumbers: selectedNumbers,
                timestamp: Date.now()
            };
            localStorage.setItem('sorteo_user_session', JSON.stringify(sessionData));
            console.log('üíæ Sesi√≥n guardada:', sessionData);
            return sessionData;
        }
        
        function getUserSession() {
            try {
                const sessionData = localStorage.getItem('sorteo_user_session');
                if (sessionData) {
                    const parsed = JSON.parse(sessionData);
                    // Verificar que la sesi√≥n no sea muy antigua (24 horas)
                    const maxAge = 24 * 60 * 60 * 1000; // 24 horas en ms
                    if (Date.now() - parsed.timestamp < maxAge) {
                        console.log('üì± Sesi√≥n recuperada:', parsed);
                        return parsed;
                    }
                }
            } catch (error) {
                console.error('‚ùå Error recuperando sesi√≥n:', error);
            }
            return null;
        }
        
        function clearUserSession() {
            localStorage.removeItem('sorteo_user_session');
            console.log('üóëÔ∏è Sesi√≥n limpiada');
        }
        
        // Funciones de test
        function saveTestSession() {
            const phone = document.getElementById('testPhone').value;
            const name = document.getElementById('testName').value;
            
            if (!phone || !name) {
                showResult('Por favor completa ambos campos', 'warning');
                return;
            }
            
            const session = saveUserSession(phone, name, [17, 22, 45]);
            showResult(`Sesi√≥n guardada exitosamente:<br>
                       Tel√©fono: ${session.phoneNumber}<br>
                       Nombre: ${session.fullName}<br>
                       N√∫meros: ${session.selectedNumbers.join(', ')}<br>
                       Timestamp: ${new Date(session.timestamp).toLocaleString()}`, 'success');
        }
        
        function loadTestSession() {
            const session = getUserSession();
            if (session) {
                document.getElementById('testPhone').value = session.phoneNumber;
                document.getElementById('testName').value = session.fullName;
                showResult(`Sesi√≥n cargada exitosamente:<br>
                           Tel√©fono: ${session.phoneNumber}<br>
                           Nombre: ${session.fullName}<br>
                           N√∫meros: ${session.selectedNumbers.join(', ')}<br>
                           Edad: ${Math.round((Date.now() - session.timestamp) / 1000 / 60)} minutos`, 'success');
            } else {
                showResult('No hay sesi√≥n guardada o ha expirado', 'warning');
            }
        }
        
        function showSessionInfo() {
            const session = getUserSession();
            if (session) {
                const age = Math.round((Date.now() - session.timestamp) / 1000 / 60);
                const remaining = Math.round((24 * 60) - age);
                showResult(`Informaci√≥n de sesi√≥n:<br>
                           <strong>Tel√©fono:</strong> ${session.phoneNumber}<br>
                           <strong>Nombre:</strong> ${session.fullName}<br>
                           <strong>N√∫meros:</strong> ${session.selectedNumbers.join(', ')}<br>
                           <strong>Creada hace:</strong> ${age} minutos<br>
                           <strong>Expira en:</strong> ${remaining} minutos<br>
                           <strong>Tama√±o:</strong> ${JSON.stringify(session).length} bytes`, 'info');
            } else {
                showResult('No hay sesi√≥n activa', 'secondary');
            }
        }
        
        function clearTestSession() {
            clearUserSession();
            document.getElementById('testPhone').value = '';
            document.getElementById('testName').value = '';
            showResult('Sesi√≥n limpiada exitosamente', 'success');
        }
        
        function showResult(message, type) {
            const resultsDiv = document.getElementById('sessionResults');
            resultsDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
        }
        
        // Cargar sesi√≥n al iniciar
        window.onload = function() {
            const session = getUserSession();
            if (session) {
                showResult(`Sesi√≥n existente detectada: ${session.phoneNumber} - ${session.fullName}`, 'info');
            } else {
                showResult('No hay sesi√≥n guardada', 'secondary');
            }
        };
    </script>
</body>
</html>
